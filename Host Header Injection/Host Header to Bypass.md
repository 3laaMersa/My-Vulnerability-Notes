# Host Header to Bypass

## 1 -  Bypass URL Path Filtering

### Scenario:

- A WAF is configured to block access to the `/admin` path.

### Attack:

1. The attacker sends a request with a manipulated `Host` header:

```php
GET /admin HTTP/1.1
Host: attacker.com
```

1. The WAF processes the request based on the `Host` header and does not apply the URL path filtering correctly, allowing the request to bypass the restriction and reach the `/admin` path on the web server.

### Impact:

- Unauthorized access to administrative interfaces.

---

## 2 -  Bypass SQL Injection Protection

### Scenario:

A WAF is configured to block SQL injection attempts based on known attack patterns in specific headers, such as the `User-Agent`.

### Attack:

1. The attacker injects malicious payloads via the `Host` header

```php
GET /search?q=test HTTP/1.1
Host: example.com' OR '1'='1
```

1. The WAF fails to inspect the `Host` header for SQL injection patterns, allowing the malicious payload to pass through and reach the back-end server.

### Impact:

- SQL injection vulnerability is exploited, leading to data exfiltration or database manipulation.

---

## 3 -   Spoofing to Evade IP-Based Filtering

### Scenario:

A WAF is configured to block access based on the client's IP address.

### Attack:

1. The attacker uses a proxy to manipulate the `Host` header:

```php
GET / HTTP/1.1
Host: example.com
	X-Forwarded-For: 192.168.0.1
```

1. The WAF incorrectly trusts the `X-Forwarded-For` header, which can be spoofed, and fails to block the request from the attackerâ€™s real IP address.

### Impact:

- Attackers can bypass IP-based access controls and launch attacks from banned IP addresses.

---

## 4 -   Poisoning to Bypass Domain Restrictions

### Scenario:

A WAF restricts access to certain functionalities based on the domain specified in the `Host` header.

### Attack:

1. The attacker sends a request with a manipulated `Host` header to gain access to restricted functionalities:

```php
GET /special-function HTTP/1.1
Host: internal.example.com

```

1. The WAF fails to properly validate the `Host` header, allowing the attacker to access internal functionalities that should only be accessible within the internal network.

### Impact:

- Unauthorized access to internal or restricted functionalities, leading to potential data breaches or manipulation.

---

## 5-  Evade Authentication Mechanisms

### Scenario:

A WAF is configured to ensure certain authentication mechanisms are enforced based on the `Host` header.

### Attack:

1. The attacker manipulates the `Host` header to bypass authentication checks:

```php
GET /login HTTP/1.1
Host: example.com
X-Original-Host: trusted.example.com
```

1. The WAF mistakenly trusts the `X-Original-Host` header and skips authentication for the attacker.

### Impact:

- Attackers can bypass authentication mechanisms and gain unauthorized access to the application.

---

### Mitigation Strategies:

1. **Strict Header Validation**:
    - Ensure that the WAF validates and sanitizes all incoming headers, including `Host`.
2. **WAF Configuration**:
    - Configure the WAF to correctly handle multiple headers and prevent spoofing.
3. **Server-Side Validation**:
    - Implement server-side validation to verify the authenticity of headers, ensuring that they match expected values.
4. **Logging and Monitoring**:
    - Log all incoming `Host` headers and monitor for anomalies to detect potential bypass attempts.