- # API Pentesting
    - **First methodology for Weakness  [ information disclosed via API ]**
        
        ---
        
        ### So Now we need to fuzz for get all endpoints and parameters
        
        ### **we can use ffuf**
        
        ---
        
        **Search for parameters in the URL:**
        
        ```php
         ffuf -u [https://web-assets.tide.co/](https://example.com/path) -w wordlist/api.txt -mc al
        ```
        
        `-mc all` = Displays all code received for the HTTP response.
        
        **Search for parameters in the request body :**
        
        ```php
        ffuf -u [https://web-assets.tide.co/](https://example.com/path) -w wordlist/api.txt -X POST -d 'FUZZ=value' -mc all
        ```
        
        `-d 'FUZZ=value'`: "FUZZ" is used as part of the body data to be sent.
        `-X POST` Specifies the use of the POST method. 
        
        **Searching for parameters in headers:**
        
        ```php
        ffuf -u [https://web-assets.tide.co/](https://example.com/path) -w wordlist/api.txt  -H "FUZZ: value" -mc all
        ```
        
        `-H "FUZZ: value"` "FUZZ" is used as part of the header.
        
        ---
        
        ***for example***
        
        1. [http://example.com/customers/103](http://example.com/customers/103)   ⇒  401
        2. [http://example.com/customers/103/orders](http://example.com/customers/103/orders) ⇒  200
        3. [http://example.com/customers/103/orders/21](http://example.com/customers/103/orders/21) ⇒  200
        
        > Sometime the original endpoint is protected , but whatever is built upon it will be completely ignored
        > 
    - **Second methodology for Weakness  [ I**nsecure direct object reference (IDOR)]
        
        > In first case we can not access the users profile but we can access some important information related to them
        > 
        
        **now in thes cas we can access the user account [ account tackover ] =Broken object level authorization (BOLA)**
        
        ---
        
        we have an API request that allows users to view their account information. The URL would look like this: 
        `https://example.com/api/v2/user/user_id`
        
        ---
        
        Suppose we have a user named aaa and id = 123
        `https://example.com/api/v2/user/123`
        
        Sending a GET HTTP request to the above endpoint will return the account information of user “test”.
        
        ```
        {
        	"Email": "aaa@gmail.com",
        	"Address":"example address for aaa"
        }
        ```
        
        If attacker replaces the user_id with a different user_id that belongs to another user,ex 456 ,this can have unexpected effects.
        `https://example.com/api/v2/user/456`
        The API would now return the account information of some other user, even though the user “test” should not be able to view this information.
        
        ```
        {
        	"Email": "bbb@gmail.com",
        	"Address":"example address for bbb"
        }
        ```
        
    - **Therd methodology for Weakness  [ Broken validation of JWT Token ]**
        
        > As we can see in the JSON Web Token tutorial after decryption, we can manipulate the data (payload) of the jwt token and encrypt it again
        > 
        
        For Exampel :
        
        This is the original token
        
        ```json
        {
          "sub": "1234567890",
          "Permission ": "user",
          "iat": 1516239022
        }
        ```
        
        **we can manipulate the Permission for example be change it like that :**
        
        ```json
        {
          "sub": "1234567890",
          "Permission ": "admin",
          "iat": 1516239022
        }
        ```
        
        **jwt will be**
        
        > eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwiUGVybWlzc2lvbiAiOiJhZG1pbiIsImlhdCI6MTUxNjIzOTAyMn0.RwhNeQml4YEd1SpZKLd1HZKL071YojnJ5jp1r6NNBfU
        > 
        
        ![Untitled](img/Untitled.png)
        
        ### Now if we use this token in header request we can able to access the admin panel
        

###